<!-- templates/admin/product_form.html -->
{% extends "base.html" %}
{% block content %}
<div class="container">
  <h1 class="h4 mb-3">{{ 'Створення товару' if not product else 'Редагування товару' }}</h1>
  <form method="post" class="row g-3">
    <div class="col-12 col-md-4">
      <label class="form-label">SKU</label>
      <input name="sku" class="form-control" value="{{ product.sku if product else '' }}" required>
    </div>
    <div class="col-12 col-md-8">
      <label class="form-label">Назва</label>
      <input name="name" class="form-control" value="{{ product.name if product else '' }}" required>
    </div>
    <div class="col-12">
      <label class="form-label">Опис</label>
      <textarea name="description" class="form-control" rows="3">{{ product.description if product else '' }}</textarea>
    </div>
    <div class="col-12 col-md-4">
      <label class="form-label">Віск</label>
      <input name="wax_type" class="form-control" value="{{ product.wax_type if product else '' }}">
    </div>
    <div class="col-12 col-md-4">
      <label class="form-label">Категорія</label>
      <input name="category" class="form-control" value="{{ product.category if product else '' }}">
    </div>
    <div class="col-12 col-md-4">
      <label class="form-label">Ціна (базова)</label>
      <input name="price" type="number" step="0.01" class="form-control" value="{{ product.price if product else '0.00' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Ширина</label>
      <input name="width" type="number" step="0.1" class="form-control" value="{{ product.width if product else '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Висота</label>
      <input name="height" type="number" step="0.1" class="form-control" value="{{ product.height if product else '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Глибина</label>
      <input name="depth" type="number" step="0.1" class="form-control" value="{{ product.depth if product else '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Вага</label>
      <input name="weight" type="number" step="0.1" class="form-control" value="{{ product.weight if product else '' }}">
    </div>
    <div class="col-12">
      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" name="is_active" id="is_active"
               {% if product and product.is_active %}checked{% endif %}>
        <label class="form-check-label" for="is_active">Активний товар</label>
      </div>
    </div>






    <div class="col-12">
      <button class="btn btn-primary" type="submit">Зберегти</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('admin.product_list') }}">Назад</a>
    </div>
  </form>

  {% if product %}
  <hr class="my-4">

  <h2 class="h5 mb-3">Кольори</h2>
  <form method="post" action="{{ url_for('admin.color_add', product_id=product.id) }}" class="row g-2">
    <div class="col-12 col-md-3">
      <input name="color_name" class="form-control" placeholder="Назва кольору" required>
    </div>
    <div class="col-12 col-md-3">
      <input name="color_hex" class="form-control" placeholder="#FFFFFF" required>
    </div>
    <div class="col-12 col-md-2">
      <input name="price_modifier" type="number" step="0.01" class="form-control" placeholder="0.10">
    </div>
    <div class="col-12 col-md-2">
      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" name="is_default" id="is_default">
        <label class="form-check-label" for="is_default">За замовчуванням</label>
      </div>
    </div>
    <div class="col-12 col-md-2">
      <button class="btn btn-outline-primary w-100" type="submit">Додати</button>
    </div>
  </form>
  <ul class="list-group my-3">
    {% for c in colors %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <span class="badge me-2" style="background:{{ c.color_hex }};">&nbsp;&nbsp;</span>
          {{ c.color_name }}
          {% if c.is_default %}<span class="badge text-bg-secondary ms-2">default</span>{% endif %}
          {% if c.price_modifier %}<span class="small text-muted ms-2">+{{ (c.price_modifier*100)|round(0) }}%</span>{% endif %}
        </div>
        <form method="post" action="{{ url_for('admin.color_delete', color_id=c.id) }}">
          <button class="btn btn-outline-danger btn-sm" type="submit">Видалити</button>
        </form>
      </li>
    {% else %}
      <li class="list-group-item">Немає кольорів.</li>
    {% endfor %}
  </ul>

  <h2 class="h5 mb-3">Фото</h2>
  <form method="post" action="{{ url_for('admin.image_add', product_id=product.id) }}" enctype="multipart/form-data" class="row g-2">
    <div class="col-12 col-md-5">
      <input type="file" name="image" class="form-control" accept=".jpg,.jpeg,.png,.gif" required>
    </div>
    <div class="col-12 col-md-3">
      <input name="alt_text" class="form-control" placeholder="alt text">
    </div>
    <div class="col-12 col-md-2">
      <input name="sort_order" type="number" class="form-control" placeholder="Сортування">
    </div>
    <div class="col-12 col-md-2">
      <button class="btn btn-outline-primary w-100" type="submit">Додати фото</button>
    </div>
  </form>
  <div class="row mt-3">
    {% for img in images %}
      <div class="col-6 col-md-3 mb-3 text-center">
        <img src="{{ url_for('static', filename='img/uploads/' ~ (img.preview_filename or img.filename)) }}" class="img-fluid img-thumbnail" alt="{{ img.alt_text }}">
        <form method="post" action="{{ url_for('admin.image_delete', image_id=img.id) }}" class="mt-2">
          <button class="btn btn-outline-danger btn-sm">Видалити</button>
        </form>
      </div>
    {% else %}
      <p>Немає фото.</p>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}