{% extends "base.html" %}
{% block content %}
<div class="container">
  <h1 class="h4 mb-3">{{ 'Створення товару' if not product else 'Редагування товару' }}</h1>

  <form method="post" enctype="multipart/form-data" class="row g-3">
    <!-- Основні дані товару -->
    <div class="col-12 col-md-4">
      <label class="form-label">SKU</label>
      <input name="sku" class="form-control" value="{{ product.sku if product else '' }}" required>
    </div>
    <div class="col-12 col-md-8">
      <label class="form-label">Назва</label>
      <input name="name" class="form-control" value="{{ product.name if product else '' }}" required>
    </div>
    <div class="col-12">
      <label class="form-label">Опис</label>
      <textarea name="description" class="form-control" rows="3">{{ product.description if product else '' }}</textarea>
    </div>
    <div class="col-12 col-md-4">
      <label class="form-label">Віск</label>
      <input name="wax_type" class="form-control" value="{{ product.wax_type if product else '' }}">
    </div>
    <div class="col-12 col-md-4">
      <label class="form-label">Категорія</label>
      <input name="category" class="form-control" value="{{ product.category if product else '' }}">
    </div>
    <div class="col-12 col-md-4">
      <label class="form-label">Ціна (базова)</label>
      <input name="price" type="number" step="0.01" class="form-control" value="{{ product.price if product else '0.00' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Ширина</label>
      <input name="width" type="number" step="0.1" class="form-control" value="{{ product.width if product else '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Висота</label>
      <input name="height" type="number" step="0.1" class="form-control" value="{{ product.height if product else '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Глибина</label>
      <input name="depth" type="number" step="0.1" class="form-control" value="{{ product.depth if product else '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Вага</label>
      <input name="weight" type="number" step="0.1" class="form-control" value="{{ product.weight if product else '' }}">
    </div>
    <div class="col-12">
      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" name="is_active" id="is_active"
               {% if product and product.is_active %}checked{% endif %}>
        <label class="form-check-label" for="is_active">Активний товар</label>
      </div>
    </div>

    <!-- Кольори -->
    <hr class="my-4">
    <h2 class="h5 mb-3">Кольори</h2>
    <div id="color-fields">
      <div class="row g-2 mb-2 color-row">
        <div class="col-12 col-md-4">
          <input name="color_name" class="form-control" placeholder="Назва кольору">
        </div>
        <div class="col-12 col-md-4">
          <input name="color_hex" class="form-control" placeholder="#FFFFFF">
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addColor()">+ Додати колір</button>
    {% if colors %}
      <ul class="list-group my-3">
        {% for c in colors %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <span class="badge me-2" style="background:{{ c.color_hex }};">&nbsp;&nbsp;</span>
              {{ c.color_name }}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <!-- Фото -->
    <hr class="my-4">
    <h2 class="h5 mb-3">Фото</h2>
    <div class="row g-2" id="image-fields">
      <div class="col-12 col-md-6">
        <input type="file" name="images" class="form-control" accept=".jpg,.jpeg,.png,.gif" multiple>
      </div>
    </div>
    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addImage()">+ Додати фото</button>
    <div class="row mt-3">
      {% for img in images %}
        <div class="col-6 col-md-3 mb-3 text-center">
          <img src="{{ url_for('static', filename='img/uploads/' ~ (img.preview_filename or img.filename)) }}"
               class="img-fluid img-thumbnail" alt="{{ img.alt_text }}">
        </div>
      {% endfor %}
    </div>

    <!-- Кнопка зберегти -->
    <div class="col-12 mt-4">
      <button class="btn btn-primary" type="submit">Зберегти все</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('admin.product_list') }}">Назад</a>
    </div>
  </form>
</div>


<script>
function addColor() {
  const container = document.getElementById("color-fields");
  const row = document.querySelector(".color-row").cloneNode(true);
  row.querySelectorAll("input").forEach(input => input.value = "");
  container.appendChild(row);
}
function addImage() {
  const container = document.getElementById("image-fields");
  const input = document.createElement("input");
  input.type = "file";
  input.name = "images";
  input.className = "form-control mb-2";
  input.accept = ".jpg,.jpeg,.png,.gif";
  container.appendChild(input);
}

</script>

{% endblock %}